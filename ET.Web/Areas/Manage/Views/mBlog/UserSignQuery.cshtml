@{
    Layout = null;
    Layout = "~/Areas/Manage/Views/Shared/_ManagePartial.cshtml";
}
@section Title{
    博客用户签到
}
@section Header{
}

<div class="ManageBody">
    <div class="ManageListTitle"></div>
    <fieldset class="ManageSearch" style="">
        <legend>信息查询</legend>
        <table class="datatable">
            <tr>
                <th style="width:80px;">
                    用户名称：
                </th>
                <td>
                    <input id="txtSearch" style="width: 175px" type="text" data-options="prompt:'请输入查询内容'"
                           class="search input" />

                    <a href='javascript:queryClick()' class='easyui-linkbutton' data-options='iconCls:"icon-search"'>
                        查询
                    </a>
                </td>
            </tr>
        </table>
    </fieldset>
    <div class="ManageList">
        <table id="InfoGridData"></table>
    </div>
</div>

<script type="text/javascript">
    $(function () {
        $("#ManageMain").css("width", $(document).width() - 10)


        //操作按钮，此处需要添加操作权限控制
        var toolbarnode = [
            {
                text: '删除',
                iconCls: 'icon-remove',
                handler: fixDel
            }, '-'
        ]
        $('#InfoGridData').datagrid({
            width: $(document).width() - 10,
            height: 380,
            fitColumns: false,
            striped: true,
            nowrap: false,
            showFooter: true,
            url: "./ajaxquerySignpagelist", method: 'get',
            collapsible: false,
            remoteSort: false,
            showFooter: true,
            singleSelect: true,
            pagination: true,
            rownumbers: true,
            pageSize: 10,
            columns: [[
                    { field: 'SignID', width: 10, title: 'ID', sortable: true, hidden: true },
                    { field: 'Reserve1', width: 220, title: '用户名', sortable: true },
    { field: 'Reserve2', width: 220, title: '用户等级', sortable: true },
                    { field: 'CreateTime', width: 220, title: '签到时间', sortable: true, formatter: DateHelper.DateTimeFormatter }
            ]],
            toolbar: toolbarnode

        });
    });


    function fixDel() {
        var selected = $('#InfoGridData').datagrid('getChecked');
        if (null == selected || selected.length < 1) {
            TopNotify("请选择数据", 'info');
            return;
        }
        $.messager.confirm("确认提示框", "确认删除这 " + selected.length + " 条吗？", function (r) {
            if (r) {
                var ls = $.map(selected, function (a) { return "'" + a.SignID + "'"; }).toString();
                $.post('./AjaxDeleteSign', { infoid: ls }, function (res) {
                    if (res == "true") {
                        $("#InfoGridData").datagrid('reload')
                        TopNotify("数据已删除", 'info');
                    }
                    else {
                        TopNotify(res, 'error');
                    }
                });
            }
        });
    };

  
    function queryClick() {
        $("#InfoGridData").datagrid('load', getQueryParam());
    };

    function getQueryParam() {
        var query = { name: $("#txtSearch").val() };
        return query;
    };
</script>

